---
title: 运维-新服务器宝塔环境配置
tags:
  - 服务器
  - CentOS
  - CentOS 7
  - 宝塔服务
  - 宝塔
  - BT
abbrlink: '84884080'
date: 2024-04-03 15:45:20
---

## 前言
  > 完成 [CentOS-服务器初始化配置](https://blog.themismin.com/posts/9d04baee.html)

## 安装
1. 安全组开放以下端口
8888、20 、21、 39000-40000端口、22 (SSH)、80、443（网站及SSL）
8888,3389,888（phpmyadmin）,80,443,20,21

2. 将域名解析道该服务器

3. 在线安装
打开 [Linux面板8.0.6在线安装](https://www.bt.cn/new/download.html)
填好表单自动安装（ssh不要关闭密码登录）
```
Nginx-1.20
PHP-8.0
MySQL-5.7
不安装PHPMyAdmin
pureftpd
```

4. 配置
打开宝塔管理面板
- 修改端口
- 绑定域名
- 立即【开启SSL证书】保护面板安全（Let's Encrypt 证书）
```
1. 进入服务器目录
cd /www/server/panel/ssl
2. 重新生成密钥
openssl pkcs12 -export -in certificate.pem  -inkey privateKey.pem  -out cp.p12
3. 输入密码(可以随便设置,但是不能为空, 建议设置成官方的密码 怕忘记 www.bt.cn )
Enter Export Password:
Verifying - Enter Export Password:
4. 下载cp.p12 文件 导入钥匙串,并设置始终信任,保存,输入密码.
5. 重启浏览器 刷新 ok了
```

5. 配置php
- 安装扩展
fileinfo redis mcrypt imagemagick exif intl xsl Swoole4
- 移除禁用函数

6. 网站-添加站点
添加站点、开启SSL（Let's Encrypt）
网站目录设置：/public
伪静态设置：laravel5

7. 服务器www账号配置
```
# 修改用户登入时的目录
usermod -d /home/www www
# 修改用户登入后所使用的shell
usermod -s /bin/bash www
cat /etc/passwd
# 创建www项目源码目录
mkdir -p /www/wwwsource
chown www:www /www/wwwsource/
# 创建www项目配置目录
mkdir -p /www/wwwconfig
chown www:www /www/wwwconfig/
# 修改www项目目录权限
chown www:www /www/wwwroot/
# 切换 www 账号
su - www

# www账号下 生成证书
ssh-keygen
# 添加公钥
vim .ssh/authorized_keys
chmod 600 .ssh/authorized_keys
```

8. root权限下修改文件权限遇到 chmod: changing permissions of '***': Operation not permitted
```
lsattr可用来查看文件的属性：

lsattr .user.ini
 如果文件属性中有i与a，或者有其中的一个

可以使用chattr去掉这属性：

chattr -ia .user.ini
此时再次使用chmod命令即可更改文件的权限。

```